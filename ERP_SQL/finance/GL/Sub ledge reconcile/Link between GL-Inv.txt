
 apps.GL_JE_JOURNAL_LINES_V
 apps.GL_IMPORT_REFERENCES
 MTL_TRANSACTION_ACCOUNTS

MTL_TRANSACTION_ACCOUNTS.GL_BATCH_ID = apps.GL_IMPORT_REFERENCES.REFERENCE_1

-----*******************************************Inventory*************************************************

---------------------NEW 2004-7-28 9:28
CREATE OR REPLACE VIEW BMC_ACCOUNT_QUERY_INV AS
SELECT  GL_JL.PERIOD_NAME             PERIOD_NAME,
 DECODE (MMT.TRANSACTION_ACTION_ID,
      2, DECODE (SIGN (MMT.PRIMARY_QUANTITY),
                 -1, TO_CHAR (MMT.TRANSACTION_ID),
                 TO_CHAR (MMT.TRANSFER_TRANSACTION_ID)
                ),
      5, DECODE (SIGN (MMT.PRIMARY_QUANTITY),
                 -1, TO_CHAR (MMT.TRANSACTION_ID),
                 TO_CHAR (MMT.TRANSFER_TRANSACTION_ID)
                ),
      3, TO_CHAR (MTA.TRANSACTION_ID),
      TO_CHAR (MMT.TRANSACTION_ID)
     )              TRX_NUMBER,
      TRUNC(MMT.TRANSACTION_DATE)             TRX_DATE,
      GL_JB.NAME                       JE_BATCH_NAME,
      GL_JH.NAME                       JE_HEADER_NAME,
      GL_JH.JE_CATEGORY                JE_CATEGORY, 
      GL_JH.JE_SOURCE                  JE_SOURCE,
      GC_CC.SEGMENT                    ACCOUNT_NUMBER,
      GC_CC.SEGMENT1                   SEGMENT1,
      GC_CC.SEGMENT2                   SEGMENT2,
      GC_CC.SEGMENT3                   SEGMENT3,
      GC_CC.SEGMENT4                   SEGMENT4,
      GC_CC.SEGMENT5                   SEGMENT5,
      GC_CC.SEGMENT6                   SEGMENT6,
      GC_CC.SEGMENT7                   SEGMENT7,
      DECODE (SIGN (NVL (MTA.TRANSACTION_VALUE, MTA.BASE_TRANSACTION_VALUE)),
              1, NVL (MTA.TRANSACTION_VALUE, MTA.BASE_TRANSACTION_VALUE),0,0,NULL) ENTERED_DR,
      DECODE (SIGN (NVL (MTA.TRANSACTION_VALUE, MTA.BASE_TRANSACTION_VALUE)),
               -1, (-1 * NVL (MTA.TRANSACTION_VALUE,MTA.BASE_TRANSACTION_VALUE)),NULL) ENTERED_CR,
      DECODE (SIGN (MTA.BASE_TRANSACTION_VALUE),1, MTA.BASE_TRANSACTION_VALUE, 0, 0,NULL) ACCOUNTED_DR,
      DECODE (SIGN (MTA.BASE_TRANSACTION_VALUE),-1, (-1 * MTA.BASE_TRANSACTION_VALUE),NULL) ACCOUNTED_CR,
      GL_JH.CURRENCY_CODE             CURRENCY_CODE,
      MTT.TRANSACTION_TYPE_NAME       TRX_DESC,
      TRUNC(MMT.TRANSACTION_DATE)            GL_DATE,
      GL_JH.SET_OF_BOOKS_ID           SET_OF_BK_ID,       
      MMT.RCV_TRANSACTION_ID          RCV_ID,
      MTA.CURRENCY_CONVERSION_RATE    CC_RATE,
      MMT.CREATION_DATE               CREATION_DATE,
       NVL(FND.DESCRIPTION,FND.USER_NAME)     CREATED_BY   
 FROM GL_JE_BATCHES        GL_JB,
      GL_JE_HEADERS        GL_JH,
      GL_JE_LINES          GL_JL,
      BMC_CCID_SEG3        GC_CC,
      GL_IMPORT_REFERENCES R,
      GL_SETS_OF_BOOKS     SOB,
      GL_PERIOD_STATUSES   GPS,
      MTL_TRANSACTION_ACCOUNTS  MTA,
      MTL_MATERIAL_TRANSACTIONS MMT,
      MTL_TRANSACTION_TYPES     MTT,
      FND_USER                  FND
WHERE GL_JB.JE_BATCH_ID = GL_JH.JE_BATCH_ID
  AND GL_JL.JE_HEADER_ID= GL_JH.JE_HEADER_ID 
  AND GL_JL.JE_HEADER_ID= R.JE_HEADER_ID    
  AND GL_JL.JE_LINE_NUM = R.JE_LINE_NUM     
  AND GL_JL.CODE_COMBINATION_ID = GC_CC.CCID
  AND MMT.TRANSFER_TRANSACTION_ID = MTA.TRANSACTION_ID
  AND MMT.PRIMARY_QUANTITY = MTA.PRIMARY_QUANTITY
  AND MMT.INVENTORY_ITEM_ID = MTA.INVENTORY_ITEM_ID
  AND MMT.CREATED_BY        = FND.USER_ID
  AND MTT.TRANSACTION_TYPE_ID = MMT.TRANSACTION_TYPE_ID
  AND GL_JL.PERIOD_NAME = GPS.PERIOD_NAME 
  AND MTA.TRANSACTION_DATE BETWEEN GPS.START_DATE
                               AND (TRUNC (GPS.END_DATE) + 0.99999)
  AND MMT.TRANSACTION_DATE BETWEEN GPS.START_DATE
                               AND (TRUNC (GPS.END_DATE) + 0.99999)
  AND SOB.SET_OF_BOOKS_ID = GPS.SET_OF_BOOKS_ID
  AND GL_JL.SET_OF_BOOKS_ID = SOB.SET_OF_BOOKS_ID
  AND MTA.GL_BATCH_ID = R.REFERENCE_1
  AND (   (    R.GL_SL_LINK_ID IS NOT NULL
           AND R.REFERENCE_3 IS NOT NULL
           AND MTA.TRANSACTION_ID = R.REFERENCE_3
           AND MTA.GL_SL_LINK_ID = R.GL_SL_LINK_ID
          )
      OR (    R.GL_SL_LINK_ID IS NULL
           AND R.REFERENCE_3 IS NULL
           AND GL_JL.CODE_COMBINATION_ID = MTA.REFERENCE_ACCOUNT 
           AND NVL (MTA.CURRENCY_CODE, SOB.CURRENCY_CODE) =  GL_JH.CURRENCY_CODE
           AND MTA.ENCUMBRANCE_TYPE_ID IS NULL
           AND NVL (MTA.ENCUMBRANCE_TYPE_ID, -1) = NVL (GL_JH.ENCUMBRANCE_TYPE_ID,-1)
           AND NVL (MMT.USSGL_TRANSACTION_CODE, '#ZZZ') = NVL (GL_JH.USSGL_TRANSACTION_CODE, '#ZZZ')
          )
      )    
     AND GPS.APPLICATION_ID = 401     
     AND MTT.TRANSACTION_TYPE_NAME<>'Direct Org Transfer'
     AND MMT.TRANSACTION_ACTION_ID IN (2, 3, 5)
     AND MMT.PRIMARY_QUANTITY > 0
     AND GL_JB.ACTUAL_FLAG='A'
     AND GL_JH.STATUS ='P'  
     AND (GL_JH.ACCRUAL_REV_JE_HEADER_ID IS NULL OR GL_JH.ACCRUAL_REV_STATUS ='R')
     AND GL_JH.JE_CATEGORY = 'MTL'
     AND GL_JH.JE_SOURCE = 'Inventory'        
UNION ALL
SELECT GL_JL.PERIOD_NAME             PERIOD_NAME,
 DECODE (MMT.TRANSACTION_ACTION_ID,
      2, DECODE (SIGN (MMT.PRIMARY_QUANTITY),
                 -1, TO_CHAR (MMT.TRANSACTION_ID),
                 TO_CHAR (MMT.TRANSFER_TRANSACTION_ID)
                ),
      5, DECODE (SIGN (MMT.PRIMARY_QUANTITY),
                 -1, TO_CHAR (MMT.TRANSACTION_ID),
                 TO_CHAR (MMT.TRANSFER_TRANSACTION_ID)
                ),
      3, TO_CHAR (MTA.TRANSACTION_ID),
      TO_CHAR (MMT.TRANSACTION_ID)
     )              TRX_NUMBER,
      TRUNC(MMT.TRANSACTION_DATE)             TRX_DATE,
      GL_JB.NAME                       JE_BATCH_NAME,
      GL_JH.NAME                       JE_HEADER_NAME,
      GL_JH.JE_CATEGORY                JE_CATEGORY, 
      GL_JH.JE_SOURCE                  JE_SOURCE,
      GC_CC.SEGMENT                    ACCOUNT_NUMBER,
      GC_CC.SEGMENT1                   SEGMENT1,
      GC_CC.SEGMENT2                   SEGMENT2,
      GC_CC.SEGMENT3                   SEGMENT3,
      GC_CC.SEGMENT4                   SEGMENT4,
      GC_CC.SEGMENT5                   SEGMENT5,
      GC_CC.SEGMENT6                   SEGMENT6,
      GC_CC.SEGMENT7                   SEGMENT7,
      DECODE (SIGN (NVL (MTA.TRANSACTION_VALUE, MTA.BASE_TRANSACTION_VALUE)),
              1, NVL (MTA.TRANSACTION_VALUE, MTA.BASE_TRANSACTION_VALUE),0,0,NULL) ENTERED_DR,
      DECODE (SIGN (NVL (MTA.TRANSACTION_VALUE, MTA.BASE_TRANSACTION_VALUE)),
               -1, (-1 * NVL (MTA.TRANSACTION_VALUE,MTA.BASE_TRANSACTION_VALUE)),NULL) ENTERED_CR,
      DECODE (SIGN (MTA.BASE_TRANSACTION_VALUE),1, MTA.BASE_TRANSACTION_VALUE, 0, 0,NULL) ACCOUNTED_DR,
      DECODE (SIGN (MTA.BASE_TRANSACTION_VALUE),-1, (-1 * MTA.BASE_TRANSACTION_VALUE),NULL) ACCOUNTED_CR,
      GL_JH.CURRENCY_CODE             CURRENCY_CODE,
      MTT.TRANSACTION_TYPE_NAME       TRX_DESC,
      TRUNC(MMT.TRANSACTION_DATE)            GL_DATE,
      GL_JH.SET_OF_BOOKS_ID           SET_OF_BK_ID,       
      MMT.RCV_TRANSACTION_ID          RCV_ID,
      MTA.CURRENCY_CONVERSION_RATE    CC_RATE,
      MMT.CREATION_DATE               CREATION_DATE,
       NVL(FND.DESCRIPTION,FND.USER_NAME)     CREATED_BY   
 FROM GL_JE_BATCHES        GL_JB,
      GL_JE_HEADERS        GL_JH,
      GL_JE_LINES          GL_JL,
      BMC_CCID_SEG3        GC_CC,
      GL_IMPORT_REFERENCES R,
      GL_SETS_OF_BOOKS     SOB,
      GL_PERIOD_STATUSES   GPS,
      MTL_TRANSACTION_ACCOUNTS  MTA,
      MTL_MATERIAL_TRANSACTIONS MMT,
      MTL_TRANSACTION_TYPES     MTT,
      FND_USER                  FND
    WHERE GL_JB.JE_BATCH_ID = GL_JH.JE_BATCH_ID
      AND GL_JL.JE_HEADER_ID = GL_JH.JE_HEADER_ID
      AND GL_JL.JE_HEADER_ID= R.JE_HEADER_ID    
      AND GL_JL.JE_LINE_NUM = R.JE_LINE_NUM    
      AND GL_JL.CODE_COMBINATION_ID = GC_CC.CCID
      AND MMT.TRANSACTION_ID = MTA.TRANSACTION_ID
      AND (   MMT.TRANSACTION_ACTION_ID NOT IN (2, 3, 5)
           OR (    MMT.TRANSACTION_ACTION_ID IN (2, 3, 5)
               AND MMT.PRIMARY_QUANTITY < 0
               AND MMT.PRIMARY_QUANTITY = MTA.PRIMARY_QUANTITY
              )
          )
      AND MMT.INVENTORY_ITEM_ID = MTA.INVENTORY_ITEM_ID
      AND MMT.CREATED_BY        = FND.USER_ID
      AND MTT.TRANSACTION_TYPE_ID = MMT.TRANSACTION_TYPE_ID
      AND GL_JL.PERIOD_NAME = GPS.PERIOD_NAME 
      AND MTA.TRANSACTION_DATE BETWEEN GPS.START_DATE
                                   AND (TRUNC (GPS.END_DATE) + 0.99999)
      AND MMT.TRANSACTION_DATE BETWEEN GPS.START_DATE
                                   AND (TRUNC (GPS.END_DATE) + 0.99999)
      AND SOB.SET_OF_BOOKS_ID = GPS.SET_OF_BOOKS_ID
      AND GL_JL.SET_OF_BOOKS_ID = SOB.SET_OF_BOOKS_ID
      AND MTA.GL_BATCH_ID = R.REFERENCE_1
      AND (   (    R.GL_SL_LINK_ID IS NOT NULL
               AND R.REFERENCE_3 IS NOT NULL
               AND MTA.TRANSACTION_ID = R.REFERENCE_3
               AND MTA.GL_SL_LINK_ID = R.GL_SL_LINK_ID
              )
           OR (    R.GL_SL_LINK_ID IS NULL
               AND R.REFERENCE_3 IS NULL
               AND GL_JL.CODE_COMBINATION_ID = MTA.REFERENCE_ACCOUNT
               AND NVL (MTA.CURRENCY_CODE, SOB.CURRENCY_CODE) =   GL_JH.CURRENCY_CODE
               AND MTA.ENCUMBRANCE_TYPE_ID IS NULL
               AND NVL (MTA.ENCUMBRANCE_TYPE_ID, -1) = NVL (GL_JH.ENCUMBRANCE_TYPE_ID,-1)
               AND NVL (MMT.USSGL_TRANSACTION_CODE, '#ZZZ') =NVL (GL_JH.USSGL_TRANSACTION_CODE, '#ZZZ')
              )
          )
        AND GL_JB.ACTUAL_FLAG='A'
        AND MTT.TRANSACTION_TYPE_NAME<>'Direct Org Transfer'
        AND GPS.APPLICATION_ID = 401  
        AND (GL_JH.ACCRUAL_REV_JE_HEADER_ID IS NULL OR GL_JH.ACCRUAL_REV_STATUS ='R')
        AND GL_JH.STATUS ='P'  
        AND GL_JH.JE_CATEGORY = 'MTL'
        AND GL_JH.JE_SOURCE = 'Inventory'   
UNION ALL
SELECT  GL_JL.PERIOD_NAME             PERIOD_NAME,
 DECODE (MMT.TRANSACTION_ACTION_ID,
      2, DECODE (SIGN (MMT.PRIMARY_QUANTITY),
                 -1, TO_CHAR (MMT.TRANSACTION_ID),
                 TO_CHAR (MMT.TRANSFER_TRANSACTION_ID)
                ),
      5, DECODE (SIGN (MMT.PRIMARY_QUANTITY),
                 -1, TO_CHAR (MMT.TRANSACTION_ID),
                 TO_CHAR (MMT.TRANSFER_TRANSACTION_ID)
                ),
      3, TO_CHAR (MTA.TRANSACTION_ID),
      TO_CHAR (MMT.TRANSACTION_ID)
     )              TRX_NUMBER,
      TRUNC(MMT.TRANSACTION_DATE)             TRX_DATE,
      GL_JB.NAME                       JE_BATCH_NAME,
      GL_JH.NAME                       JE_HEADER_NAME,
      GL_JH.JE_CATEGORY                JE_CATEGORY, 
      GL_JH.JE_SOURCE                  JE_SOURCE,
      GC_CC.SEGMENT                    ACCOUNT_NUMBER,
      GC_CC.SEGMENT1                   SEGMENT1,
      GC_CC.SEGMENT2                   SEGMENT2,
      GC_CC.SEGMENT3                   SEGMENT3,
      GC_CC.SEGMENT4                   SEGMENT4,
      GC_CC.SEGMENT5                   SEGMENT5,
      GC_CC.SEGMENT6                   SEGMENT6,
      GC_CC.SEGMENT7                   SEGMENT7,
      DECODE (SIGN (NVL (MTA.TRANSACTION_VALUE, MTA.BASE_TRANSACTION_VALUE)),
              1, NVL (MTA.TRANSACTION_VALUE, MTA.BASE_TRANSACTION_VALUE),0,0,NULL) ENTERED_DR,
      DECODE (SIGN (NVL (MTA.TRANSACTION_VALUE, MTA.BASE_TRANSACTION_VALUE)),
               -1, (-1 * NVL (MTA.TRANSACTION_VALUE,MTA.BASE_TRANSACTION_VALUE)),NULL) ENTERED_CR,
      DECODE (SIGN (MTA.BASE_TRANSACTION_VALUE),1, MTA.BASE_TRANSACTION_VALUE, 0, 0,NULL) ACCOUNTED_DR,
      DECODE (SIGN (MTA.BASE_TRANSACTION_VALUE),-1, (-1 * MTA.BASE_TRANSACTION_VALUE),NULL) ACCOUNTED_CR,
      GL_JH.CURRENCY_CODE             CURRENCY_CODE,
      MTT.TRANSACTION_TYPE_NAME       TRX_DESC,
      TRUNC(MMT.TRANSACTION_DATE)            GL_DATE,
      GL_JH.SET_OF_BOOKS_ID           SET_OF_BK_ID,       
      MMT.RCV_TRANSACTION_ID          RCV_ID,
      MTA.CURRENCY_CONVERSION_RATE    CC_RATE,
      MMT.CREATION_DATE               CREATION_DATE,
       NVL(FND.DESCRIPTION,FND.USER_NAME)     CREATED_BY  
 FROM GL_JE_BATCHES        GL_JB,
      GL_JE_HEADERS        GL_JH,
      GL_JE_LINES          GL_JL,
      BMC_CCID_SEG3        GC_CC,
      GL_IMPORT_REFERENCES R,
      GL_SETS_OF_BOOKS     SOB,
      GL_PERIOD_STATUSES   GPS,
      MTL_TRANSACTION_ACCOUNTS  MTA,
      MTL_MATERIAL_TRANSACTIONS MMT,
      MTL_TRANSACTION_TYPES     MTT,
      FND_USER                  FND
WHERE GL_JB.JE_BATCH_ID = GL_JH.JE_BATCH_ID
  AND GL_JL.JE_HEADER_ID = GL_JH.JE_HEADER_ID
  AND GL_JL.JE_HEADER_ID = R.JE_HEADER_ID    
  AND GL_JL.JE_LINE_NUM = R.JE_LINE_NUM     
  AND GL_JL.CODE_COMBINATION_ID = GC_CC.CCID
  AND MMT.TRANSFER_TRANSACTION_ID = MTA.TRANSACTION_ID
  AND MMT.INVENTORY_ITEM_ID = MTA.INVENTORY_ITEM_ID
  AND MMT.CREATED_BY        = FND.USER_ID
  AND MTT.TRANSACTION_TYPE_ID = MMT.TRANSACTION_TYPE_ID
  AND GL_JL.PERIOD_NAME = GPS.PERIOD_NAME 
  AND MTA.TRANSACTION_DATE BETWEEN GPS.START_DATE
                               AND (TRUNC (GPS.END_DATE) + 0.99999)
  AND MMT.TRANSACTION_DATE BETWEEN GPS.START_DATE
                               AND (TRUNC (GPS.END_DATE) + 0.99999)
  AND SOB.SET_OF_BOOKS_ID = GPS.SET_OF_BOOKS_ID
  AND GL_JL.SET_OF_BOOKS_ID = SOB.SET_OF_BOOKS_ID
  AND MTA.GL_BATCH_ID = R.REFERENCE_1
  AND GL_JH.JE_CATEGORY = 'MTL'
  AND (   (    R.GL_SL_LINK_ID IS NOT NULL
           AND R.REFERENCE_3 IS NOT NULL
           AND MTA.TRANSACTION_ID = R.REFERENCE_3
           AND MTA.GL_SL_LINK_ID = R.GL_SL_LINK_ID
          )
       OR (    R.GL_SL_LINK_ID IS NULL
           AND R.REFERENCE_3 IS NULL
           AND GL_JL.CODE_COMBINATION_ID = MTA.REFERENCE_ACCOUNT 
           AND NVL (MTA.CURRENCY_CODE, SOB.CURRENCY_CODE) =  GL_JH.CURRENCY_CODE
           AND MTA.ENCUMBRANCE_TYPE_ID IS NULL
           AND NVL (MTA.ENCUMBRANCE_TYPE_ID, -1) = NVL (GL_JH.ENCUMBRANCE_TYPE_ID, -1)
           AND NVL (MMT.USSGL_TRANSACTION_CODE, '#ZZZ') =NVL (GL_JH.USSGL_TRANSACTION_CODE, '#ZZZ')
          )
      )      
     AND MTT.TRANSACTION_TYPE_NAME='Direct Org Transfer'
     AND MMT.TRANSACTION_ACTION_ID IN (2, 3, 5)
     AND GPS.APPLICATION_ID = 401
     AND GL_JB.ACTUAL_FLAG='A'
     AND (GL_JH.ACCRUAL_REV_JE_HEADER_ID IS NULL OR GL_JH.ACCRUAL_REV_STATUS ='R')
     AND GL_JH.STATUS ='P'  
     AND GL_JH.JE_CATEGORY = 'MTL'
     AND GL_JH.JE_SOURCE = 'Inventory'
UNION ALL
SELECT GL_JL.PERIOD_NAME           PERIOD_NAME,
       TO_CHAR (wt.transaction_id) TRX_NUMBER,
       TRUNC (wt.transaction_date) TRX_DATE,
       GL_JB.NAME                  JE_BATCH_NAME,
       GL_JH.NAME                  JE_HEADER_NAME,
       GL_JH.JE_CATEGORY                      JE_CATEGORY, 
        GL_JH.JE_SOURCE         JE_SOURCE,
       GC_CC.SEGMENT               ACCOUNT_NUMBER,
        GC_CC.SEGMENT1                  SEGMENT1,
        GC_CC.SEGMENT2                  SEGMENT2,
        GC_CC.SEGMENT3                  SEGMENT3,
        GC_CC.SEGMENT4                  SEGMENT4,
        GC_CC.SEGMENT5                  SEGMENT5,
        GC_CC.SEGMENT6                  SEGMENT6,
        GC_CC.SEGMENT7                  SEGMENT7,
       DECODE (SIGN (NVL (wta.transaction_value,wta.base_transaction_value)),
               1, NVL (wta.transaction_value, wta.base_transaction_value), 0, 0,NULL) ENTERED_DR,
       DECODE (SIGN (NVL (wta.transaction_value,wta.base_transaction_value)),
               -1, (-1* NVL (wta.transaction_value,wta.base_transaction_value)),NULL) ENTERED_CR,
       DECODE (SIGN (wta.base_transaction_value),1, wta.base_transaction_value,0, 0,NULL)     ACCOUNTED_DR,
       DECODE (SIGN (wta.base_transaction_value), -1, (-1 * wta.base_transaction_value),NULL) ACCOUNTED_CR,
       GL_JH.currency_code         CURRENCY_CODE,
       LU1.MEANING                 TRX_DESC,
       TRUNC (wt.transaction_date) GL_DATE,
       GL_JH.SET_OF_BOOKS_ID         SET_OF_BK_ID,
       NULL                          RCV_ID,
      WTA.CURRENCY_CONVERSION_RATE  CC_RATE,
       WT.CREATION_DATE              CREATION_DATE,
       NVL(FND.DESCRIPTION,FND.USER_NAME)     CREATED_BY   
FROM   GL_JE_BATCHES        GL_JB,
       GL_JE_HEADERS        GL_JH,
       GL_JE_LINES          GL_JL,
       BMC_CCID_SEG3        GC_CC,
       GL_IMPORT_REFERENCES R,
       GL_PERIOD_STATUSES GPS,
       GL_SETS_OF_BOOKS SOB,
       WIP_TRANSACTION_ACCOUNTS WTA,
       ORG_ORGANIZATION_DEFINITIONS OOD,
       WIP_TRANSACTIONS WT,
       MFG_LOOKUPS LU1,
       FND_USER    FND
 WHERE GL_JB.JE_BATCH_ID = GL_JH.JE_BATCH_ID
   AND GL_JL.JE_HEADER_ID = GL_JH.JE_HEADER_ID
   AND GL_JL.JE_HEADER_ID = R.JE_HEADER_ID    
   AND GL_JL.JE_LINE_NUM = R.JE_LINE_NUM    
   AND GL_JL.CODE_COMBINATION_ID = GC_CC.CCID
   AND WTA.TRANSACTION_ID = WT.TRANSACTION_ID
   AND LU1.LOOKUP_TYPE(+) = 'WIP_TRANSACTION_TYPE'
   AND LU1.LOOKUP_CODE(+) = WT.TRANSACTION_TYPE
   AND SOB.SET_OF_BOOKS_ID = OOD.SET_OF_BOOKS_ID
   AND GPS.SET_OF_BOOKS_ID = OOD.SET_OF_BOOKS_ID
   AND GPS.PERIOD_NAME = GL_JH.PERIOD_NAME
   AND WTA.TRANSACTION_DATE BETWEEN GPS.START_DATE
                                AND (TRUNC (GPS.END_DATE) + 0.99999)
   AND WT.ORGANIZATION_ID = OOD.ORGANIZATION_ID
   AND WT.CREATED_BY      = FND.USER_ID
   AND GL_JL.SET_OF_BOOKS_ID = SOB.SET_OF_BOOKS_ID 
   AND R.GL_SL_LINK_ID IS NOT NULL
   AND R.REFERENCE_3 IS NOT NULL
   AND WTA.GL_BATCH_ID = R.REFERENCE_1
   AND WTA.TRANSACTION_ID = R.REFERENCE_3
   AND GL_JL.CODE_COMBINATION_ID = WTA.REFERENCE_ACCOUNT 
   AND WTA.GL_SL_LINK_ID = R.GL_SL_LINK_ID
   AND GPS.APPLICATION_ID = 401
   AND GL_JH.STATUS ='P'  
   AND GL_JB.ACTUAL_FLAG='A'
   AND (GL_JH.ACCRUAL_REV_JE_HEADER_ID IS NULL OR GL_JH.ACCRUAL_REV_STATUS ='R')
   AND GL_JH.JE_CATEGORY = 'WIP'
   AND GL_JH.JE_SOURCE = 'Inventory'
UNION ALL
SELECT GL_JL.PERIOD_NAME           PERIOD_NAME,
       TO_CHAR (WT.TRANSACTION_ID) TRX_NUMBER,
       TRUNC (WT.transaction_date) TRX_DATE,
       GL_JB.NAME                  JE_BATCH_NAME,
       GL_JH.NAME                  JE_HEADER_NAME,
       GL_JH.JE_CATEGORY                      JE_CATEGORY, 
        GL_JH.JE_SOURCE         JE_SOURCE,
       GC_CC.SEGMENT               ACCOUNT_NUMBER,
        GC_CC.SEGMENT1                  SEGMENT1,
        GC_CC.SEGMENT2                  SEGMENT2,
        GC_CC.SEGMENT3                  SEGMENT3,
        GC_CC.SEGMENT4                  SEGMENT4,
        GC_CC.SEGMENT5                  SEGMENT5,
        GC_CC.SEGMENT6                  SEGMENT6,
        GC_CC.SEGMENT7                  SEGMENT7,
       DECODE (SIGN (NVL (wta.transaction_value,wta.base_transaction_value)),
                1, NVL (wta.transaction_value, wta.base_transaction_value), 0, 0, NULL ) ENTERED_DR,
       DECODE (SIGN (NVL (wta.transaction_value,wta.base_transaction_value)),
               -1, (  -1 * NVL (wta.transaction_value,wta.base_transaction_value)),NULL) ENTERED_CR,
       DECODE (SIGN (wta.base_transaction_value),1, wta.base_transaction_value,0,0,NULL) ACCOUNTED_DR,
       DECODE (SIGN (wta.base_transaction_value),-1, (-1 * wta.base_transaction_value),NULL) ACCOUNTED_CR,
       GL_JH.currency_code         CURRENCY_CODE,
       LU1.MEANING                 TRX_DESC,
       TRUNC (WT.transaction_date)    GL_DATE,
       GL_JH.SET_OF_BOOKS_ID         SET_OF_BK_ID,
       NULL                          RCV_ID,
       WTA.CURRENCY_CONVERSION_RATE  CC_RATE,
       WT.CREATION_DATE              CREATION_DATE,
       NVL(FND.DESCRIPTION,FND.USER_NAME)     CREATED_BY   
FROM   GL_JE_BATCHES        GL_JB,
       GL_JE_HEADERS        GL_JH,
       GL_JE_LINES          GL_JL,
       BMC_CCID_SEG3        GC_CC,
       GL_IMPORT_REFERENCES R,
       GL_PERIOD_STATUSES GPS,
       GL_SETS_OF_BOOKS SOB,
       WIP_TRANSACTION_ACCOUNTS WTA,
       WIP_TRANSACTIONS WT,
       ORG_ORGANIZATION_DEFINITIONS OOD,
       MFG_LOOKUPS LU1,
       FND_USER    FND
WHERE GL_JB.JE_BATCH_ID = GL_JH.JE_BATCH_ID
  AND GL_JL.JE_HEADER_ID = GL_JH.JE_HEADER_ID
  AND GL_JL.JE_HEADER_ID = R.JE_HEADER_ID    
  AND GL_JL.JE_LINE_NUM = R.JE_LINE_NUM    
  AND GL_JL.CODE_COMBINATION_ID = GC_CC.CCID
  AND WTA.TRANSACTION_ID = WT.TRANSACTION_ID
  AND LU1.LOOKUP_TYPE(+) = 'WIP_TRANSACTION_TYPE'
  AND LU1.LOOKUP_CODE(+) = WT.TRANSACTION_TYPE
  AND SOB.SET_OF_BOOKS_ID = OOD.SET_OF_BOOKS_ID
  AND GPS.APPLICATION_ID = 401
  AND GPS.SET_OF_BOOKS_ID = OOD.SET_OF_BOOKS_ID
  AND GPS.PERIOD_NAME = GL_JH.PERIOD_NAME
  AND WTA.TRANSACTION_DATE BETWEEN GPS.START_DATE AND GPS.END_DATE
  AND WT.ORGANIZATION_ID = OOD.ORGANIZATION_ID
  AND WT.CREATED_BY      = FND.USER_ID
  AND GL_JL.SET_OF_BOOKS_ID = SOB.SET_OF_BOOKS_ID 
  AND WTA.GL_BATCH_ID = R.REFERENCE_1
  AND R.GL_SL_LINK_ID IS NULL
  AND R.REFERENCE_3 IS NULL
  AND WTA.REFERENCE_ACCOUNT + 0 = GL_JL.CODE_COMBINATION_ID
  AND NVL (WTA.CURRENCY_CODE, SOB.CURRENCY_CODE) = GL_JH.CURRENCY_CODE
  AND (GL_JH.ACCRUAL_REV_JE_HEADER_ID IS NULL OR GL_JH.ACCRUAL_REV_STATUS ='R')
  AND GL_JB.ACTUAL_FLAG='A'
  AND GL_JH.STATUS ='P'  
  AND GL_JH.JE_CATEGORY = 'WIP'
  AND GL_JH.JE_SOURCE = 'Inventory';
