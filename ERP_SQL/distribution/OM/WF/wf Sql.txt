

select  CWIAS.ITEM_TYPE ITEM_TYPE, 
          CWIAS.ITEM_KEY ITEM_KEY, 
           CWPA.instance_id ACTID,
        CWPA.INSTANCE_LABEL LABEL,
        to_char(CWIAS.BEGIN_DATE, 'DD-MON-YY HH24:MI:SS') BEGIN_DATE,
        decode(greatest(CWIAS.BEGIN_DATE ,sysdate),cwias.begin_date,'WAIT','DEFERRED') STATUS,
     pwpa.*
    from apps.WF_ITEM_ACTIVITY_STATUSES CWIAS, 
      apps.WF_PROCESS_ACTIVITIES CWPA,
         apps.WF_ACTIVITIES CWA, 
   apps.WF_ITEMS WI,
         apps.WF_PROCESS_ACTIVITIES PWPA, 
   apps.WF_ITEM_ACTIVITY_STATUSES PWIAS
    where 1=1
 --AND  CWIAS.ACTIVITY_STATUS = 'DEFERRED'
   -- and CWIAS.BEGIN_DATE=trunc(SYSDATE) -- uncomment this line for just deferred activities
    and CWIAS.PROCESS_ACTIVITY = CWPA.INSTANCE_ID
    and CWPA.ACTIVITY_ITEM_TYPE = CWA.ITEM_TYPE
    and CWPA.ACTIVITY_NAME = CWA.NAME
    and CWIAS.ITEM_TYPE = WI.ITEM_TYPE
    and CWIAS.ITEM_KEY = WI.ITEM_KEY
    and WI.BEGIN_DATE >= CWA.BEGIN_DATE
    and WI.BEGIN_DATE < nvl(CWA.END_DATE, WI.BEGIN_DATE+1)
    and CWPA.PROCESS_NAME = PWPA.ACTIVITY_NAME
    and CWPA.PROCESS_ITEM_TYPE = PWPA.ACTIVITY_ITEM_TYPE
    and PWPA.INSTANCE_ID = PWIAS.PROCESS_ACTIVITY
    and PWIAS.ITEM_TYPE = CWIAS.ITEM_TYPE
    and PWIAS.ITEM_KEY = CWIAS.ITEM_KEY
 AND   USER_KEY LIKE '%309139%'
   AND   WI.ITEM_KEY='1299577'-- in('777654','1299577')

